package com.kaisn.utils;

import java.io.InputStream;
import java.util.ArrayList;
import java.util.List;

import javax.servlet.ServletOutputStream;

import org.apache.poi.hssf.usermodel.HSSFCell;
import org.apache.poi.hssf.usermodel.HSSFCellStyle;
import org.apache.poi.hssf.usermodel.HSSFFont;
import org.apache.poi.hssf.usermodel.HSSFRow;
import org.apache.poi.hssf.usermodel.HSSFSheet;
import org.apache.poi.hssf.usermodel.HSSFWorkbook;
import org.apache.poi.ss.usermodel.Cell;
import org.apache.poi.ss.usermodel.HorizontalAlignment;
import org.apache.poi.ss.usermodel.Row;
import org.apache.poi.ss.usermodel.Sheet;
import org.apache.poi.ss.usermodel.VerticalAlignment;
import org.apache.poi.ss.usermodel.Workbook;
import org.apache.poi.ss.util.CellRangeAddress;
import org.apache.poi.xssf.usermodel.XSSFWorkbook;

import com.kaisn.pojo.Department;
import com.kaisn.pojo.Employee;

public class ExcelUtils {

	public static void exportExcel(List<Employee> empList, ServletOutputStream out) {
		try {
			HSSFWorkbook workbook = new HSSFWorkbook();
			CellRangeAddress callRangeAddress = new CellRangeAddress(0, 0, 0, 4);// 璧峰琛�,缁撴潫琛�,璧峰鍒�,缁撴潫鍒�
			HSSFCellStyle headStyle = createCellStyle(workbook, (short) 16);
			HSSFCellStyle colStyle = createCellStyle(workbook, (short) 13);
			HSSFSheet sheet = workbook.createSheet("员工列表");
			sheet.addMergedRegion(callRangeAddress);
			sheet.setDefaultColumnWidth(25);
			// 3.鍒涘缓琛�
			// 3.1鍒涘缓澶存爣棰樿;骞朵笖璁剧疆澶存爣棰�
			HSSFRow row = sheet.createRow(0);
			HSSFCell cell = row.createCell(0);

			// 鍔犺浇鍗曞厓鏍兼牱寮�
			cell.setCellStyle(headStyle);
			cell.setCellValue("鐢ㄦ埛鍒楄〃");

			// 3.2鍒涘缓鍒楁爣棰�;骞朵笖璁剧疆鍒楁爣棰�
			HSSFRow row2 = sheet.createRow(1);
			String[] titles = { "鍛樺伐濮撳悕", "閭", "鎵�灞為儴闂�", "鎬у埆" };
			for (int i = 0; i < titles.length; i++) {
				HSSFCell cell2 = row2.createCell(i);
				// 鍔犺浇鍗曞厓鏍兼牱寮�
				cell2.setCellStyle(colStyle);
				cell2.setCellValue(titles[i]);
			}
			// 4.鎿嶄綔鍗曞厓鏍�;灏嗙敤鎴峰垪琛ㄥ啓鍏xcel
			if (empList != null) {
				for (int j = 0; j < empList.size(); j++) {
					// 鍒涘缓鏁版嵁琛�,鍓嶉潰鏈変袱琛�,澶存爣棰樿鍜屽垪鏍囬琛�
					HSSFRow row3 = sheet.createRow(j + 2);
					HSSFCell cell1 = row3.createCell(0);
					cell1.setCellValue(empList.get(j).getEmpName());
					HSSFCell cell2 = row3.createCell(1);
					cell2.setCellValue(empList.get(j).getEmail());
					HSSFCell cell3 = row3.createCell(2);
					cell3.setCellValue(empList.get(j).getDepartment().getDeptName());
					HSSFCell cell4 = row3.createCell(3);
					cell4.setCellValue("M".equals(empList.get(j).getGender()) ? "鐢�" : "濂�");
				}
			}
			// 5.杈撳嚭
			workbook.write(out);
			workbook.close();
			// out.close();
		} catch (Exception e) {
			e.printStackTrace();
		}
	}

	/**
	 * 
	 * @param workbook
	 * @param fontsize
	 * @return 鍗曞厓鏍兼牱寮�
	 */
	private static HSSFCellStyle createCellStyle(HSSFWorkbook workbook, short fontsize) {
		// TODO Auto-generated method stub
		HSSFCellStyle style = workbook.createCellStyle();
		style.setAlignment(HorizontalAlignment.CENTER);// 姘村钩灞呬腑
		style.setVerticalAlignment(VerticalAlignment.CENTER);// 鍨傜洿灞呬腑
		// 鍒涘缓瀛椾綋
		HSSFFont font = workbook.createFont();
		font.setBold(true);
		font.setFontHeightInPoints(fontsize);
		// 鍔犺浇瀛椾綋
		style.setFont(font);
		return style;
	}

	public static List<Employee> importExcel(InputStream inputStream, String excelFileName) {
		List<Employee> emps = new ArrayList<Employee>();
		// 1.鍒涘缓杈撳叆娴�
		try {
			boolean is03Excel = excelFileName.matches("^.+\\.(?i)(xls)$");
			// 1.璇诲彇宸ヤ綔绨�
			Workbook workbook = is03Excel ? new HSSFWorkbook(inputStream) : new XSSFWorkbook(inputStream);
			// 2.璇诲彇宸ヤ綔琛�
			Sheet sheet = workbook.getSheetAt(0);
			// 3.璇诲彇琛�
			// 鍒ゆ柇琛屾暟澶т簬浜�,鏄洜涓烘暟鎹粠绗笁琛屽紑濮嬫彃鍏�
			if (sheet.getPhysicalNumberOfRows() > 2) {
				Employee emp = null;
				// 璺宠繃鍓嶄袱琛�
				for (int k = 2; k < sheet.getPhysicalNumberOfRows(); k++) {
					// 璇诲彇鍗曞厓鏍�
					Row row0 = sheet.getRow(k);
					emp = new Employee();
					// 鐢ㄦ埛鍚�
					Cell cell0 = row0.getCell(0);
					emp.setEmpName(cell0.getStringCellValue());
					// 璐﹀彿
					Cell cell1 = row0.getCell(1);
					emp.setEmail(cell1.getStringCellValue());
					// 鎵�灞為儴闂�
					Cell cell2 = row0.getCell(2);
					Department dept = new Department();
					dept.setDeptName(cell2.getStringCellValue());
					emp.setDepartment(dept);
					// 璁剧疆鎬у埆
					Cell cell3 = row0.getCell(3);
					emp.setGender("鐢�".equals(cell3.getStringCellValue()) ? "M" : "F");
					emps.add(emp);
				}
			}
			workbook.close();
			inputStream.close();
		} catch (Exception e) {
			e.printStackTrace();
		}
		return emps;
	}
}
